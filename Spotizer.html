<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotizer</title>
  <link rel="stylesheet" href="style.css">
  <!-- IcÃ´ne par dÃ©faut -->
  <link rel="icon" type="image/png" href="Musique/Images/font.webp">
  <style>
    h1 {
      text-align: center;
      margin: 20px 0;
      color: #1DB954;
    }
    .music-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      margin-bottom: 8px;
    }
    .music-item {
      width: 200px;
      background-color: #1E1E1E;
      border-radius: 8px;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      transition: transform 0.2s, opacity 0.2s;
      cursor: pointer;
    }
    .music-item:hover {
      transform: scale(1.05);
    }
    .music-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .music-title {
      padding: 10px;
      font-size: 16px;
      color: #fff;
    }
    .music-item.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    .music-item.current {
      border: 3px solid #f3d708;
      box-shadow: 0 0 15px 5px rgba(255, 183, 1, 0.7);
      transform: scale(1.08);
    }
    /* Barre du lecteur */
    .player-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #282828;
      padding: 10px 1px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.5);
    }
    .controls-volume-container {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .controls button {
      background: none;
      border: none;
      padding: 5px;
      cursor: pointer;
    }
    .controls button img {
      width: 40px;
      height: 40px;
    }
    .time-control {
      flex-grow: 1;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
    }
    .slider {
      width: 50%;
      margin: 0 10px;
    }
    .volume-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-right: 10px;
    }
    .volume-control img {
      width: 25px;
      height: 25px;
    }
    .volume-control input {
      width: 150px;
    }
    .exclude-checkbox {
      margin: 10px;
      color: white;
      font-size: 14px;
    }
    /* Titre de la piste en cours, fixÃ© au-dessus de la barre */
    #currentTrack {
      position: fixed;
      bottom: 50px; 
      left: 40px;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 32px;
      z-index: 1000;
      text-shadow: 2px 2px 4px #ff0000;
    }
  </style>
</head>
<body>
  <h1>ðŸŽµ Spotizer ðŸŽµ</h1>

  <div class="music-container" id="musicContainer">
    <!-- Les Ã©lÃ©ments musicaux seront gÃ©nÃ©rÃ©s ici -->
  </div>

  <!-- Titre de la musique en cours fixÃ© au-dessus de la barre -->
  <div id="currentTrack"></div>

  <!-- Barre du lecteur -->
  <div class="player-bar">
    <div class="controls-volume-container">
      <div class="controls">
        <button onclick="previousTrack()">
          <img src="Musique/Images/avant.png" alt="PrÃ©cÃ©dent">
        </button>
        <button onclick="togglePlay()" id="playPauseButton">
          <img src="Musique/Images/play.png" alt="Lecture">
        </button>
        <button onclick="nextTrack()">
          <img src="Musique/Images/suivant.png" alt="Suivant">
        </button>
        <button onclick="toggleShuffle()">
          <img src="Musique/Images/shuffle.png" alt="AlÃ©atoire">
        </button>
        <button onclick="toggleLoop()" id="loopButton">
          <img src="Musique/Images/boucle.png" alt="Boucle">
        </button>
      </div>

      <div class="time-control">
        <span id="currentTime">0:00</span>
        <input type="range" id="seekBar" class="slider" min="0" max="100" value="0" oninput="seekMusic()">
        <span id="totalTime">0:00</span>
      </div>

      <div class="volume-control">
        <img src="Musique/Images/volume.png" alt="Volume">
        <input type="range" id="volumeBar" min="0" max="1" step="0.01" value="1" oninput="changeVolume()">
      </div>
    </div>
  </div>

  <audio id="audioPlayer"></audio>

  <script>
    const musicContainer = document.getElementById("musicContainer");
    const audioPlayer = document.getElementById("audioPlayer");
    const seekBar = document.getElementById("seekBar");
    const volumeBar = document.getElementById("volumeBar");
    const playPauseButton = document.getElementById("playPauseButton");
    const loopButton = document.getElementById("loopButton");
    const currentTimeLabel = document.getElementById("currentTime");
    const totalTimeLabel = document.getElementById("totalTime");

    const musics = [
      { title: "Un quart d'heure", src: "Musique/Musique1.mp3", image: "Musique/Images/font1.png" },
      { title: "CÃ´te Ouest", src: "Musique/Musique2.mp3", image: "Musique/Images/font2.png" },
      { title: "Harakiri", src: "Musique/Musique3.mp3", image: "Musique/Images/font3.png" },
      { title: "Assieds toi", src: "Musique/Musique4.mp3", image: "Musique/Images/font4.png" },
      { title: "Jamais su", src: "Musique/Musique5.mp3", image: "Musique/Images/font5.png" },
      { title: "Soleil noir", src: "Musique/Musique6.mp3", image: "Musique/Images/font6.png" },
      { title: "Un air qui fait", src: "Musique/Musique7.mp3", image: "Musique/Images/font7.png" },
      { title: "1000Â°C", src: "Musique/Musique8.mp3", image: "Musique/Images/font8.png" },
      { title: "Wellerman (Sea Shanty)", src: "Musique/Musique9.mp3", image: "Musique/Images/font9.png" },
      { title: "I Can't Fit In", src: "Musique/Musique10.mp3", image: "Musique/Images/font10.png" },
      { title: "C'est pas grave", src: "Musique/Musique11.mp3", image: "Musique/Images/font11.png" },
      { title: "Chaque soir", src: "Musique/Musique12.mp3", image: "Musique/Images/font12.png" },
      { title: "Sur tes pas", src: "Musique/Musique13.mp3", image: "Musique/Images/font13.png" },
      { title: "Fairytale", src: "Musique/Musique14.mp3", image: "Musique/Images/font14.png" },
      { title: "Malade", src: "Musique/Musique15.mp3", image: "Musique/Images/font15.png" },
      { title: "Something In The Way", src: "Musique/Musique16.mp3", image: "Musique/Images/font16.png" },
      { title: "Smells Like Teen Spirit", src: "Musique/Musique17.mp3", image: "Musique/Images/font17.png" },
      { title: "Come As You Are", src: "Musique/Musique18.mp3", image: "Musique/Images/font18.png" },
      { title: "Dans l'univers", src: "Musique/Musique19.mp3", image: "Musique/Images/font19.png" },
      { title: "PoupÃ©e Russe", src: "Musique/Musique20.mp3", image: "Musique/Images/font20.png" },
      { title: "Ã€ peu prÃ¨s", src: "Musique/Musique21.mp3", image: "Musique/Images/font21.png" },
      { title: "Toutes les machines ont un coeur", src: "Musique/Musique22.mp3", image: "Musique/Images/font22.png" },
      { title: "Ã‰pisode III - Les mains libres", src: "Musique/Musique23.mp3", image: "Musique/Images/font23.png" },
      { title: "Voulez-vous", src: "Musique/Musique24.mp3", image: "Musique/Images/font24.png" },
      { title: "Toxic", src: "Musique/Musique25.mp3", image: "Musique/Images/font25.png" },
      { title: "Sans toi", src: "Musique/Musique26.mp3", image: "Musique/Images/font26.png" },
      { title: "Black Catcher", src: "Musique/Musique27.mp3", image: "Musique/Images/font27.png" },
      { title: "Femme Ã  la mer", src: "Musique/Musique28.mp3", image: "Musique/Images/font28.png" },
      { title: "Chute d'Ã©toiles", src: "Musique/Musique29.mp3", image: "Musique/Images/font29.png" },
      { title: "Dis-moi que tu me dÃ©testes.", src: "Musique/Musique30.mp3", image: "Musique/Images/font30.png" },
      { title: "Sundance", src: "Musique/Musique31.mp3", image: "Musique/Images/font31.png" },
      { title: "30", src: "Musique/Musique32.mp3", image: "Musique/Images/font32.png" },
      { title: "Trop beau", src: "Musique/Musique33.mp3", image: "Musique/Images/font33.png" },
      { title: "La QuÃªte", src: "Musique/Musique34.mp3", image: "Musique/Images/font34.png" },
      { title: "DÃ©prime", src: "Musique/Musique35.mp3", image: "Musique/Images/font35.png" },
      { title: "Tchin Tchin", src: "Musique/Musique36.mp3", image: "Musique/Images/font36.png" },
      { title: "Decrescendo", src: "Musique/Musique37.mp3", image: "Musique/Images/font37.png" },
      { title: "Astronaute", src: "Musique/Musique38.mp3", image: "Musique/Images/font38.png" },
      { title: "DÃ©passÃ©", src: "Musique/Musique39.mp3", image: "Musique/Images/font39.png" },
      { title: "Hit Sale", src: "Musique/Musique40.mp3", image: "Musique/Images/font40.png" },
      { title: "Pierre, feuille, papier, ciseaux", src: "Musique/Musique41.mp3", image: "Musique/Images/font41.png" },
      { title: "THE LONELIEST", src: "Musique/Musique42.mp3", image: "Musique/Images/font42.png" },
      { title: "Daylight", src: "Musique/Musique43.mp3", image: "Musique/Images/font43.png" },
      { title: "Ceux qui rÃªvent", src: "Musique/Musique44.mp3", image: "Musique/Images/font44.png" },
      { title: "Sharks", src: "Musique/Musique45.mp3", image: "Musique/Images/font45.png" },
      { title: "I WANNA BE YOUR SLAVE", src: "Musique/Musique46.mp3", image: "Musique/Images/font46.png" },
      { title: "Riptide", src: "Musique/Musique47.mp3", image: "Musique/Images/font47.png" },
      { title: "Ã‰videmment", src: "Musique/Musique48.mp3", image: "Musique/Images/font48.png" },
      { title: "House of Memories", src: "Musique/Musique49.mp3", image: "Musique/Images/font49.png" },
      { title: "Heathens", src: "Musique/Musique50.mp3", image: "Musique/Images/font50.png" },
      { title: "Mockingbird", src: "Musique/Musique51.mp3", image: "Musique/Images/font51.png" },
      { title: "Stressed Out", src: "Musique/Musique52.mp3", image: "Musique/Images/font52.png" },
      { title: "Actrice FantÃ´me", src: "Musique/Musique53.mp3", image: "Musique/Images/font53.png" },
      { title: "Gangsta's Paradise", src: "Musique/Musique54.mp3", image: "Musique/Images/font54.png" },
      { title: "Stolen Dance", src: "Musique/Musique55.mp3", image: "Musique/Images/font55.png" },
      { title: "Feed the Machine", src: "Musique/Musique56.mp3", image: "Musique/Images/font56.png" },
      { title: "Le stade", src: "Musique/Musique57.mp3", image: "Musique/Images/font57.png" },
      { title: "Help me", src: "Musique/Musique58.mp3", image: "Musique/Images/font58.png" },
      { title: "IDGAF", src: "Musique/Musique59.mp3", image: "Musique/Images/font59.png" },
      { title: "Ma Meilleure Ennemie", src: "Musique/Musique60.mp3", image: "Musique/Images/font60.png" },
      { title: "Roi", src: "Musique/Musique61.mp3", image: "Musique/Images/font61.png" },
      { title: "Creep (feat. Tom Ellis)", src: "Musique/Musique62.mp3", image: "Musique/Images/font62.png" },
      { title: "Wicked Game (feat. Tom Ellis)", src: "Musique/Musique63.mp3", image: "Musique/Images/font63.png" },
      { title: "All Along the Watchtower (feat. Tom Ellis)", src: "Musique/Musique64.mp3", image: "Musique/Images/font64.png" },
      { title: "Im Doing Fine", src: "Musique/Musique65.mp3", image: "Musique/Images/font65.png" },
      { title: "Feel Good Inc.", src: "Musique/Musique66.mp3", image: "Musique/Images/font66.png" },
      { title: "Give and Take", src: "Musique/Musique67.mp3", image: "Musique/Images/font67.png" },
      { title: "Je ne pense qu'Ã  Ã§a", src: "Musique/Musique68.mp3", image: "Musique/Images/font68.png" },
      { title: "Crush", src: "Musique/Musique69.mp3", image: "Musique/Images/font69.png" },
      { title: "Radioactive", src: "Musique/Musique70.mp3", image: "Musique/Images/font70.png" },
      { title: "Mood", src: "Musique/Musique71.mp3", image: "Musique/Images/font71.png" },
      { title: "Vampire", src: "Musique/Musique72.mp3", image: "Musique/Images/font72.png" },
      { title: "Anxiety", src: "Musique/Musique73.mp3", image: "Musique/Images/font73.png" }
    ];
    
    let currentTrackIndex = 0;
    let isPlaying = false;
    let isShuffle = false;
    let isLooping = false;
    const excludedTracks = new Set();

    // CrÃ©ation des Ã©lÃ©ments de la liste musicale
    musics.forEach((music, index) => {
      const musicItem = document.createElement("div");
      musicItem.className = "music-item";
      musicItem.innerHTML = `
        <img src="${music.image}" alt="Pochette de ${music.title}">
        <div class="music-title">${music.title}</div>
        <label class="exclude-checkbox">
          <input type="checkbox" onchange="toggleExclude(${index})"> Exclure
        </label>
      `;
      musicItem.onclick = () => playTrack(index);
      musicItem.dataset.index = index;
      musicContainer.appendChild(musicItem);
    });

    // Met Ã  jour le titre de la page et l'icÃ´ne selon la musique en cours
    function updateSiteInfo() {
      const currentMusic = musics[currentTrackIndex];
      document.title = `ðŸŽµ ${currentMusic.title}`;
      const favicon = document.querySelector("link[rel='icon']");
      if (favicon) {
        favicon.href = currentMusic.image;
      }
    }

    // Met Ã  jour le titre affichÃ© dans la barre du lecteur
    function updateCurrentTrackDisplay() {
      const currentTrackDisplay = document.getElementById("currentTrack");
      const currentMusic = musics[currentTrackIndex];
      currentTrackDisplay.textContent = currentMusic.title;
    }

    // Met Ã  jour les mÃ©tadonnÃ©es pour l'interface verrouillÃ©e (iOS notamment)
    function updateMediaSessionMetadata() {
      if ('mediaSession' in navigator) {
        const currentMusic = musics[currentTrackIndex];
        navigator.mediaSession.metadata = new MediaMetadata({
          title: currentMusic.title,
          artist: 'Le_Bisounours_',
          album: 'Spotizer',
          artwork: [
            { src: currentMusic.image, sizes: '512x512', type: 'image/png' }
          ]
        });
      }
    }

    function playTrack(index) {
      if (excludedTracks.has(index)) return;
      currentTrackIndex = index;
      audioPlayer.src = musics[currentTrackIndex].src;
      audioPlayer.play();
      isPlaying = true;
      updatePlayPauseButton();
      updateSiteInfo();
      updateCurrentTrackDisplay();
      updateMediaSessionMetadata(); // Mise Ã  jour des mÃ©tadonnÃ©es

      // Retirer la classe "current" de tous les items
      document.querySelectorAll(".music-item").forEach(item => {
        item.classList.remove("current");
      });
      // Ajouter la classe "current" Ã  l'item correspondant
      const currentItem = musicContainer.querySelector(`.music-item[data-index="${currentTrackIndex}"]`);
      if (currentItem) {
        currentItem.classList.add("current");
      }
    }

    function togglePlay() {
      if (isPlaying) {
        audioPlayer.pause();
      } else {
        audioPlayer.play();
      }
      isPlaying = !isPlaying;
      updatePlayPauseButton();
    }

    function nextTrack() {
      do {
        currentTrackIndex = isShuffle
          ? Math.floor(Math.random() * musics.length)
          : (currentTrackIndex + 1) % musics.length;
      } while (excludedTracks.has(currentTrackIndex));
      playTrack(currentTrackIndex);
    }

    function previousTrack() {
      do {
        currentTrackIndex = (currentTrackIndex - 1 + musics.length) % musics.length;
      } while (excludedTracks.has(currentTrackIndex));
      playTrack(currentTrackIndex);
    }

    function toggleShuffle() {
      isShuffle = !isShuffle;
      alert(isShuffle ? "Lecture alÃ©atoire activÃ©e" : "Lecture alÃ©atoire dÃ©sactivÃ©e");
    }

    function toggleLoop() {
      isLooping = !isLooping;
      audioPlayer.loop = isLooping;
      alert(isLooping ? "Boucle activÃ©e" : "Boucle dÃ©sactivÃ©e");
    }

    function seekMusic() {
      const seekTo = audioPlayer.duration * (seekBar.value / 100);
      audioPlayer.currentTime = seekTo;
    }

    function changeVolume() {
      audioPlayer.volume = volumeBar.value;
    }

    function updatePlayPauseButton() {
      const playPauseIcon = isPlaying ? "Musique/Images/pause.png" : "Musique/Images/play.png";
      playPauseButton.querySelector("img").src = playPauseIcon;
    }

    function toggleExclude(index) {
      const musicItem = musicContainer.querySelector(`.music-item[data-index="${index}"]`);
      if (excludedTracks.has(index)) {
        excludedTracks.delete(index);
        musicItem.classList.remove("disabled");
      } else {
        excludedTracks.add(index);
        musicItem.classList.add("disabled");
      }
    }

    audioPlayer.addEventListener("timeupdate", () => {
      if (audioPlayer.duration) {
        seekBar.value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        currentTimeLabel.textContent = formatTime(audioPlayer.currentTime);
        totalTimeLabel.textContent = formatTime(audioPlayer.duration);
      }
    });

    audioPlayer.addEventListener("ended", () => {
      if (!isLooping) nextTrack();
    });

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60).toString().padStart(2, "0");
      return `${minutes}:${secs}`;
    }

    // Configuration des gestionnaires d'actions pour l'interface verrouillÃ©e
    if ('mediaSession' in navigator) {
      navigator.mediaSession.setActionHandler('play', togglePlay);
      navigator.mediaSession.setActionHandler('pause', togglePlay);
      navigator.mediaSession.setActionHandler('previoustrack', previousTrack);
      navigator.mediaSession.setActionHandler('nexttrack', nextTrack);
      navigator.mediaSession.setActionHandler('seekbackward', function() {
        audioPlayer.currentTime = Math.max(audioPlayer.currentTime - 10, 0);
      });
      navigator.mediaSession.setActionHandler('seekforward', function() {
        audioPlayer.currentTime = Math.min(audioPlayer.currentTime + 10, audioPlayer.duration);
      });
    }
  </script>
  <div style="text-align: center; margin-bottom: 100px;">
    <button onclick="window.location.href='musique.html'" style="padding: 10px 20px; background-color: #6f94ea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
      Retour Au Site
    </button>
  </div>
</body>
</html>
